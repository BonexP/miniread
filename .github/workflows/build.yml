name: Build Debug APKs

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
      - develop
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  build:
    name: Build Debug APKs
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up JDK
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Set up Android SDK
        uses: android-actions/setup-android@v2

      - name: Grant execute permission for gradlew
        run: chmod +x ./gradlew

      - name: Build all flavor Debug APKs
        run: |
          echo "Building Standard Debug..."
          ./gradlew assembleStandardDebug
          echo "Building E-Ink Debug..."
          ./gradlew assembleEinkDebug

      - name: List generated APKs
        run: |
          echo "Generated APK files:"
          find app/build/outputs/apk -name "*.apk" -type f

      - name: Upload Standard Debug APK
        uses: actions/upload-artifact@v4
        with:
          name: MiniRead-standard-debug
          path: app/build/outputs/apk/standard/debug/app-standard-debug.apk
          retention-days: 30

      - name: Upload E-Ink Debug APK
        uses: actions/upload-artifact@v4
        with:
          name: MiniRead-eink-debug
          path: app/build/outputs/apk/eink/debug/app-eink-debug.apk
          retention-days: 30

      - name: Build Summary
        run: |
          echo "## æž„å»ºå®Œæˆ âœ…" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "å·²æˆåŠŸæž„å»ºä»¥ä¸‹ APKï¼š" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“± Standard Debug" >> $GITHUB_STEP_SUMMARY
          echo "- æ–‡ä»¶: app-standard-debug.apk" >> $GITHUB_STEP_SUMMARY
          echo "- åº”ç”¨ ID: com.i.miniread" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“– E-Ink Debug" >> $GITHUB_STEP_SUMMARY
          echo "- æ–‡ä»¶: app-eink-debug.apk" >> $GITHUB_STEP_SUMMARY
          echo "- åº”ç”¨ ID: com.i.miniread.eink" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "å¯ä»Ž Actions çš„ Artifacts åŒºåŸŸä¸‹è½½ç¼–è¯‘å¥½çš„ APK" >> $GITHUB_STEP_SUMMARY

